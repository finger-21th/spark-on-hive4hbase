#!/bin/bash
base_path=/opt/soft/spark-3.1.1-bin-hadoop3.2
zk_host=192.168.87.13:2181,192.168.87.153:2181,192.168.87.7:2181
sql=`echo "select orders.order_code as order_code ,orders.channel_business_code as channel_business_code ,orders.platform as platform ,orders.update_time as update_time,orders.is_more_box ,orders.warehouse_code as warehouse_code ,orders.sm_code as sm_code ,orders.sc_code as sc_code ,orders.customer_code as customer_code,date_format(order_operation_time.submit_time, 'yyyy-MM-dd HH:mm:ss') as review_time_original ,date_format(order_operation_time.ship_time, 'yyyy-MM-dd HH:mm:ss') as check_out_time_original FROM fbg_dwh_dwd_das_test.mid_hive_ascan_order_big_table_01_wm orders left join fbg_dwh_ods_ods_test.out_hbase_order_operation_time order_operation_time on orders.order_operation_time_index_rowkey_id = order_operation_time.rowkey_id where order_operation_time.submit_time is not null" | sed  's/ /|/g'`
system_name=ods ##hbase ods source table business system name
sink_table=fbg_dwh_dwd_das_test.mid_hive_ascan_order_big_table_02_wm ##
jars=$base_path/dwh_lib/accessors-smart-1.2.jar,$base_path/dwh_lib/activation-1.1.1.jar,$base_path/dwh_lib/aircompressor-0.10.jar,$base_path/dwh_lib/animal-sniffer-annotations-1.17.jar,$base_path/dwh_lib/ant-1.9.1.jar,$base_path/dwh_lib/ant-launcher-1.9.1.jar,$base_path/dwh_lib/antlr4-runtime-4.8-1.jar,$base_path/dwh_lib/antlr-runtime-3.5.2.jar,$base_path/dwh_lib/aopalliance-1.0.jar,$base_path/dwh_lib/aopalliance-repackaged-2.6.1.jar,$base_path/dwh_lib/arrow-format-2.0.0.jar,$base_path/dwh_lib/arrow-memory-core-2.0.0.jar,$base_path/dwh_lib/arrow-memory-netty-2.0.0.jar,$base_path/dwh_lib/arrow-vector-2.0.0.jar,$base_path/dwh_lib/asm-5.0.4.jar,$base_path/dwh_lib/audience-annotations-0.5.0.jar,$base_path/dwh_lib/avatica-1.11.0.jar,$base_path/dwh_lib/avro-1.7.7.jar,$base_path/dwh_lib/avro-ipc-1.8.2.jar,$base_path/dwh_lib/avro-mapred-1.8.2-hadoop2.jar,$base_path/dwh_lib/bonecp-0.8.0.RELEASE.jar,$base_path/dwh_lib/calcite-core-1.16.0.jar,$base_path/dwh_lib/calcite-druid-1.16.0.jar,$base_path/dwh_lib/calcite-linq4j-1.16.0.jar,$base_path/dwh_lib/checker-qual-2.5.2.jar,$base_path/dwh_lib/chill_2.12-0.9.5.jar,$base_path/dwh_lib/chill-java-0.9.5.jar,$base_path/dwh_lib/commons-beanutils-1.9.3.jar,$base_path/dwh_lib/commons-cli-1.2.jar,$base_path/dwh_lib/commons-codec-1.11.jar,$base_path/dwh_lib/commons-collections-3.2.2.jar,$base_path/dwh_lib/commons-collections4-4.1.jar,$base_path/dwh_lib/commons-compiler-3.0.16.jar,$base_path/dwh_lib/commons-compress-1.18.jar,$base_path/dwh_lib/commons-configuration2-2.1.1.jar,$base_path/dwh_lib/commons-crypto-1.1.0.jar,$base_path/dwh_lib/commons-daemon-1.0.13.jar,$base_path/dwh_lib/commons-dbcp-1.4.jar,$base_path/dwh_lib/commons-httpclient-3.1.jar,$base_path/dwh_lib/commons-io-2.5.jar,$base_path/dwh_lib/commons-lang-2.6.jar,$base_path/dwh_lib/commons-lang3-3.7.jar,$base_path/dwh_lib/commons-logging-1.1.3.jar,$base_path/dwh_lib/commons-math3-3.1.1.jar,$base_path/dwh_lib/commons-net-3.6.jar,$base_path/dwh_lib/commons-pool-1.5.4.jar,$base_path/dwh_lib/commons-text-1.4.jar,$base_path/dwh_lib/compress-lzf-1.0.3.jar,$base_path/dwh_lib/curator-client-2.13.0.jar,$base_path/dwh_lib/curator-framework-2.12.0.jar,$base_path/dwh_lib/curator-recipes-2.13.0.jar,$base_path/dwh_lib/datanucleus-api-jdo-4.2.4.jar,$base_path/dwh_lib/datanucleus-core-4.1.17.jar,$base_path/dwh_lib/datanucleus-rdbms-4.1.19.jar,$base_path/dwh_lib/derby-10.12.1.1.jar,$base_path/dwh_lib/disruptor-3.3.6.jar,$base_path/dwh_lib/dnsjava-2.1.7.jar,$base_path/dwh_lib/error_prone_annotations-2.2.0.jar,$base_path/dwh_lib/esri-geometry-api-2.0.0.jar,$base_path/dwh_lib/failureaccess-1.0.jar,$base_path/dwh_lib/findbugs-annotations-1.3.9-1.jar,$base_path/dwh_lib/flatbuffers-java-1.9.0.jar,$base_path/dwh_lib/groovy-all-2.4.11.jar,$base_path/dwh_lib/gson-2.2.4.jar,$base_path/dwh_lib/guava-27.0-jre.jar,$base_path/dwh_lib/guice-4.0.jar,$base_path/dwh_lib/guice-servlet-4.0.jar,$base_path/dwh_lib/hbase-client-2.2.4.jar,$base_path/dwh_lib/hbase-common-2.2.4.jar,$base_path/dwh_lib/hbase-hadoop2-compat-2.2.4.jar,$base_path/dwh_lib/hbase-http-2.2.4.jar,$base_path/dwh_lib/hbase-mapreduce-2.0.0-alpha4.jar,$base_path/dwh_lib/hbase-metrics-2.2.4.jar,$base_path/dwh_lib/hbase-metrics-api-2.2.4.jar,$base_path/dwh_lib/hbase-prefix-tree-2.0.0-alpha4.jar,$base_path/dwh_lib/hbase-procedure-2.2.4.jar,$base_path/dwh_lib/hbase-protocol-2.2.4.jar,$base_path/dwh_lib/hbase-protocol-shaded-2.2.4.jar,$base_path/dwh_lib/hbase-replication-2.2.4.jar,$base_path/dwh_lib/hbase-server-2.2.4.jar,$base_path/dwh_lib/hbase-shaded-miscellaneous-2.2.1.jar,$base_path/dwh_lib/hbase-shaded-netty-2.2.1.jar,$base_path/dwh_lib/hbase-shaded-protobuf-2.2.1.jar,$base_path/dwh_lib/hbase-zookeeper-2.2.4.jar,$base_path/dwh_lib/HikariCP-2.5.1.jar,$base_path/dwh_lib/hive-classification-3.1.1.jar,$base_path/dwh_lib/hive-cli-3.1.1.jar,$base_path/dwh_lib/hive-common-2.3.7.jar,$base_path/dwh_lib/hive-exec-2.3.7-core.jar,$base_path/dwh_lib/hive-hbase-handler-3.1.1.jar,$base_path/dwh_lib/hive-hcatalog-core-3.1.1.jar,$base_path/dwh_lib/hive-hplsql-3.1.1.jar,$base_path/dwh_lib/hive-jdbc-3.1.1.jar,$base_path/dwh_lib/hive-jdbc-handler-3.1.1.jar,$base_path/dwh_lib/hive-kryo-registrator-3.1.1.jar,$base_path/dwh_lib/hive-llap-client-3.1.1.jar,$base_path/dwh_lib/hive-llap-common-3.1.1.jar,$base_path/dwh_lib/hive-llap-ext-client-3.1.1.jar,$base_path/dwh_lib/hive-llap-server-3.1.1.jar,$base_path/dwh_lib/hive-llap-tez-3.1.1.jar,$base_path/dwh_lib/hive-metastore-2.3.7.jar,$base_path/dwh_lib/hive-serde-2.3.7.jar,$base_path/dwh_lib/hive-service-3.1.1.jar,$base_path/dwh_lib/hive-service-rpc-3.1.1.jar,$base_path/dwh_lib/hive-shims-0.23-2.3.7.jar,$base_path/dwh_lib/hive-shims-2.3.7.jar,$base_path/dwh_lib/hive-shims-common-2.3.7.jar,$base_path/dwh_lib/hive-shims-scheduler-2.3.7.jar,$base_path/dwh_lib/hive-storage-api-2.7.2.jar,$base_path/dwh_lib/hive-upgrade-acid-3.1.1.jar,$base_path/dwh_lib/hive-vector-code-gen-2.3.7.jar,$base_path/dwh_lib/hk2-api-2.6.1.jar,$base_path/dwh_lib/hk2-locator-2.6.1.jar,$base_path/dwh_lib/hk2-utils-2.6.1.jar,$base_path/dwh_lib/htrace-core-4.0.0-incubating.jar,$base_path/dwh_lib/htrace-core4-4.1.0-incubating.jar,$base_path/dwh_lib/httpclient-4.5.6.jar,$base_path/dwh_lib/httpcore-4.4.4.jar,$base_path/dwh_lib/ivy-2.4.0.jar,$base_path/dwh_lib/j2objc-annotations-1.1.jar,$base_path/dwh_lib/jackson-annotations-2.10.0.jar,$base_path/dwh_lib/jackson-core-2.10.0.jar,$base_path/dwh_lib/jackson-core-asl-1.9.2.jar,$base_path/dwh_lib/jackson-databind-2.10.0.jar,$base_path/dwh_lib/jackson-jaxrs-1.9.2.jar,$base_path/dwh_lib/jackson-jaxrs-base-2.9.8.jar,$base_path/dwh_lib/jackson-jaxrs-json-provider-2.9.8.jar,$base_path/dwh_lib/jackson-mapper-asl-1.9.13.jar,$base_path/dwh_lib/jackson-module-paranamer-2.10.0.jar,$base_path/dwh_lib/jackson-module-scala_2.12-2.10.0.jar,$base_path/dwh_lib/jackson-xc-1.9.2.jar,$base_path/dwh_lib/jakarta.annotation-api-1.3.5.jar,$base_path/dwh_lib/jakarta.inject-2.6.1.jar,$base_path/dwh_lib/jakarta.servlet-api-4.0.3.jar,$base_path/dwh_lib/jakarta.validation-api-2.0.2.jar,$base_path/dwh_lib/jakarta.ws.rs-api-2.1.6.jar,$base_path/dwh_lib/jamon-runtime-2.4.1.jar,$base_path/dwh_lib/janino-3.0.16.jar,$base_path/dwh_lib/javassist-3.25.0-GA.jar,$base_path/dwh_lib/javax.el-3.0.1-b12.jar,$base_path/dwh_lib/javax.inject-1.jar,$base_path/dwh_lib/javax.jdo-3.2.0-m3.jar,$base_path/dwh_lib/javax.servlet-api-3.1.0.jar,$base_path/dwh_lib/javax.servlet.jsp-2.3.2.jar,$base_path/dwh_lib/javax.servlet.jsp-api-2.3.1.jar,$base_path/dwh_lib/javax.ws.rs-api-2.0.1.jar,$base_path/dwh_lib/javolution-5.5.1.jar,$base_path/dwh_lib/jaxb-api-2.2.11.jar,$base_path/dwh_lib/jaxb-impl-2.2.3-1.jar,$base_path/dwh_lib/jcip-annotations-1.0-1.jar,$base_path/dwh_lib/jcl-over-slf4j-1.7.30.jar,$base_path/dwh_lib/jcodings-1.0.18.jar,$base_path/dwh_lib/jdo-api-3.0.1.jar,$base_path/dwh_lib/jersey-client-1.19.jar,$base_path/dwh_lib/jersey-client-2.30.jar,$base_path/dwh_lib/jersey-common-2.30.jar,$base_path/dwh_lib/jersey-container-servlet-2.30.jar,$base_path/dwh_lib/jersey-container-servlet-core-2.30.jar,$base_path/dwh_lib/jersey-core-1.19.jar,$base_path/dwh_lib/jersey-guice-1.19.jar,$base_path/dwh_lib/jersey-hk2-2.30.jar,$base_path/dwh_lib/jersey-json-1.19.jar,$base_path/dwh_lib/jersey-media-jaxb-2.30.jar,$base_path/dwh_lib/jersey-server-1.19.jar,$base_path/dwh_lib/jersey-server-2.30.jar,$base_path/dwh_lib/jersey-servlet-1.19.jar,$base_path/dwh_lib/jettison-1.1.jar,$base_path/dwh_lib/jetty-http-9.3.24.v20180605.jar,$base_path/dwh_lib/jetty-io-9.3.24.v20180605.jar,$base_path/dwh_lib/jetty-security-9.3.24.v20180605.jar,$base_path/dwh_lib/jetty-server-9.3.24.v20180605.jar,$base_path/dwh_lib/jetty-servlet-9.3.24.v20180605.jar,$base_path/dwh_lib/jetty-util-9.3.24.v20180605.jar,$base_path/dwh_lib/jetty-util-ajax-9.3.24.v20180605.jar,$base_path/dwh_lib/jetty-webapp-9.3.24.v20180605.jar,$base_path/dwh_lib/jetty-xml-9.3.24.v20180605.jar,$base_path/dwh_lib/jline-0.9.94.jar,$base_path/dwh_lib/joda-time-2.10.5.jar,$base_path/dwh_lib/jodd-core-3.5.2.jar,$base_path/dwh_lib/joni-2.1.11.jar,$base_path/dwh_lib/jpam-1.1.jar,$base_path/dwh_lib/jsch-0.1.54.jar,$base_path/dwh_lib/json-1.8.jar,$base_path/dwh_lib/json4s-ast_2.12-3.7.0-M5.jar,$base_path/dwh_lib/json4s-core_2.12-3.7.0-M5.jar,$base_path/dwh_lib/json4s-jackson_2.12-3.7.0-M5.jar,$base_path/dwh_lib/json4s-scalap_2.12-3.7.0-M5.jar,$base_path/dwh_lib/json-smart-2.3.jar,$base_path/dwh_lib/jsp-api-2.1.jar,$base_path/dwh_lib/jsqlparser-4.0.jar,$base_path/dwh_lib/jsr305-3.0.0.jar,$base_path/dwh_lib/jsr311-api-1.1.1.jar,$base_path/dwh_lib/jta-1.1.jar,$base_path/dwh_lib/jul-to-slf4j-1.7.30.jar,$base_path/dwh_lib/kerb-admin-1.0.1.jar,$base_path/dwh_lib/kerb-client-1.0.1.jar,$base_path/dwh_lib/kerb-common-1.0.1.jar,$base_path/dwh_lib/kerb-core-1.0.1.jar,$base_path/dwh_lib/kerb-crypto-1.0.1.jar,$base_path/dwh_lib/kerb-identity-1.0.1.jar,$base_path/dwh_lib/kerb-server-1.0.1.jar,$base_path/dwh_lib/kerb-simplekdc-1.0.1.jar,$base_path/dwh_lib/kerb-util-1.0.1.jar,$base_path/dwh_lib/kerby-asn1-1.0.1.jar,$base_path/dwh_lib/kerby-config-1.0.1.jar,$base_path/dwh_lib/kerby-pkix-1.0.1.jar,$base_path/dwh_lib/kerby-util-1.0.1.jar,$base_path/dwh_lib/kerby-xdr-1.0.1.jar,$base_path/dwh_lib/kryo-shaded-4.0.2.jar,$base_path/dwh_lib/leveldbjni-all-1.8.jar,$base_path/dwh_lib/libfb303-0.9.3.jar,$base_path/dwh_lib/libthrift-0.12.0.jar,$base_path/dwh_lib/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar,$base_path/dwh_lib/log4j-1.2.17.jar,$base_path/dwh_lib/log4j-1.2-api-2.10.0.jar,$base_path/dwh_lib/log4j-api-2.10.0.jar,$base_path/dwh_lib/log4j-core-2.10.0.jar,$base_path/dwh_lib/log4j-slf4j-impl-2.10.0.jar,$base_path/dwh_lib/lz4-java-1.7.1.jar,$base_path/dwh_lib/memory-0.9.0.jar,$base_path/dwh_lib/metrics-core-4.1.1.jar,$base_path/dwh_lib/metrics-graphite-4.1.1.jar,$base_path/dwh_lib/metrics-jmx-4.1.1.jar,$base_path/dwh_lib/metrics-json-4.1.1.jar,$base_path/dwh_lib/metrics-jvm-4.1.1.jar,$base_path/dwh_lib/minlog-1.3.0.jar,$base_path/dwh_lib/mysql-connector-java-5.1.27.jar,$base_path/dwh_lib/netty-3.10.5.Final.jar,$base_path/dwh_lib/netty-all-4.1.51.Final.jar,$base_path/dwh_lib/nimbus-jose-jwt-4.41.1.jar,$base_path/dwh_lib/objenesis-2.5.1.jar,$base_path/dwh_lib/okhttp-2.7.5.jar,$base_path/dwh_lib/okio-1.6.0.jar,$base_path/dwh_lib/opencsv-2.3.jar,$base_path/dwh_lib/orc-core-1.5.12.jar,$base_path/dwh_lib/orc-mapreduce-1.5.12.jar,$base_path/dwh_lib/orc-shims-1.5.12.jar,$base_path/dwh_lib/oro-2.0.8.jar,$base_path/dwh_lib/osgi-resource-locator-1.0.3.jar,$base_path/dwh_lib/paranamer-2.8.jar,$base_path/dwh_lib/parquet-column-1.10.1.jar,$base_path/dwh_lib/parquet-common-1.10.1.jar,$base_path/dwh_lib/parquet-encoding-1.10.1.jar,$base_path/dwh_lib/parquet-format-2.4.0.jar,$base_path/dwh_lib/parquet-jackson-1.10.1.jar,$base_path/dwh_lib/protobuf-java-2.5.0.jar,$base_path/dwh_lib/py4j-0.10.9.jar,$base_path/dwh_lib/pyrolite-4.30.jar,$base_path/dwh_lib/re2j-1.1.jar,$base_path/dwh_lib/RoaringBitmap-0.9.0.jar,$base_path/dwh_lib/scala-library-2.12.8.jar,$base_path/dwh_lib/scala-parser-combinators_2.12-1.1.2.jar,$base_path/dwh_lib/scala-reflect-2.12.10.jar,$base_path/dwh_lib/scala-xml_2.12-1.2.0.jar,$base_path/dwh_lib/shims-0.9.0.jar,$base_path/dwh_lib/sketches-core-0.9.0.jar,$base_path/dwh_lib/slf4j-api-1.7.25.jar,$base_path/dwh_lib/slf4j-log4j12-1.7.25.jar,$base_path/dwh_lib/snappy-java-1.1.8.2.jar,$base_path/dwh_lib/spark-catalyst_2.12-3.1.1.jar,$base_path/dwh_lib/spark-core_2.12-3.1.1.jar,$base_path/dwh_lib/spark-hive_2.12-3.1.1.jar,$base_path/dwh_lib/spark-kvstore_2.12-3.1.1.jar,$base_path/dwh_lib/spark-launcher_2.12-3.1.1.jar,$base_path/dwh_lib/spark-network-common_2.12-3.1.1.jar,$base_path/dwh_lib/spark-network-shuffle_2.12-3.1.1.jar,$base_path/dwh_lib/spark-sketch_2.12-3.1.1.jar,$base_path/dwh_lib/spark-sql_2.12-3.1.1.jar,$base_path/dwh_lib/spark-tags_2.12-3.1.1.jar,$base_path/dwh_lib/spark-unsafe_2.12-3.1.1.jar,$base_path/dwh_lib/ST4-4.0.4.jar,$base_path/dwh_lib/stax2-api-3.1.4.jar,$base_path/dwh_lib/stax-api-1.0.1.jar,$base_path/dwh_lib/stream-2.9.6.jar,$base_path/dwh_lib/threeten-extra-1.5.0.jar,$base_path/dwh_lib/token-provider-1.0.1.jar,$base_path/dwh_lib/transaction-api-1.1.jar,$base_path/dwh_lib/univocity-parsers-2.9.1.jar,$base_path/dwh_lib/unused-1.0.0.jar,$base_path/dwh_lib/velocity-1.5.jar,$base_path/dwh_lib/woodstox-core-5.0.3.jar,$base_path/dwh_lib/xbean-asm7-shaded-4.15.jar,$base_path/dwh_lib/zookeeper-3.4.13.jar,$base_path/dwh_lib/zstd-jni-1.4.8-1.jar
$base_path/bin/spark-submit --class cn.goodcang.fbg.datamiddleground.main.SparkOnHive4Hbase \
--master yarn \
--deploy-mode cluster \
--driver-memory 1g \
--num-executors 20 \
--executor-memory 1g \
--executor-cores 1 \
--queue default \
--jars $jars \
$base_path/dwh_lib/dwh-spark-on-hive-1.0.1.jar \
$zk_host $sql $system_name $sink_table